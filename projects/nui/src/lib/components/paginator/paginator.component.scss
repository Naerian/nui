@use '../../../../styles/config';
@use '../../../../styles/mixins';
@use '../../../../styles/variables/paginator/paginator-variables.scss';

// =======================
// PAGINATOR CONTAINER
// =======================
:host {
  display: block;
  width: 100%;
}

.nui-paginator-container {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);

  // Por defecto: horizontal con wrap (para layouts simples sin áreas)
  flex-direction: row;
  flex-wrap: wrap;

  // CUSTOM LAYOUT: Sistema vertical que apila áreas horizontales
  &--custom-layout {
    flex-direction: column; // Apila top → horizontal-areas → bottom
    align-items: stretch; // Cada área ocupa todo el ancho
    flex-wrap: nowrap;
    gap: 1rem; // Separación vertical entre áreas

    // Área izquierda
    .nui-paginator__area--left {
      flex: 0 1 auto; // Ocupar solo lo necesario
      display: flex;
      gap: 0.5rem;
      align-items: center;

      // CONTAINER QUERY: Usamos el nombre del contenedor de la fila
      @container paginator-row (max-width: 1024px) {
        flex: 1 1 100%; // Ocupar todo el ancho
        justify-content: space-between; // Espacio entre elementos
      }
    }
  }

  // LAYOUT COLUMN: Forzar apilamiento vertical completo
  &--layout-column {
    flex-direction: column;
    align-items: stretch;
  }
}

// =======================
// ITEM RANGE INFO
// =======================
.nui-paginator__info {
  display: flex;
  align-items: center;

  &-text {
    font-size: var(--font-size-sm);
    color: var(--nui-text-secondary);
    font-weight: var(--font-weight-medium);
  }
}

// =======================
// PAGE SIZE SELECTOR
// =======================
.nui-paginator__page-size {
  display: flex;
  align-items: flex-start;
  gap: var(--spacing-xs);
  flex-wrap: wrap;
  flex-direction: column;

  .nui-paginator__page-size-label {
    font-size: var(--font-size-sm);
  }

  @media (orientation: portrait) and (max-width: 768px) {
    flex-direction: column;
    align-items: flex-start;

    .nui-paginator__page-size-label {
      margin-bottom: 0.25rem;
    }
  }

  &-label {
    font-size: var(--font-size-sm);
    color: var(--nui-text-secondary);
    font-weight: var(--font-weight-medium);
    white-space: nowrap;
  }
}

// =======================
// PAGE JUMP INPUT
// =======================
.nui-paginator__page-jump {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);

  &-label {
    font-size: var(--font-size-sm);
    color: var(--nui-text-secondary);
    font-weight: var(--font-weight-medium);
    white-space: nowrap;
  }

  &-input {
    width: var(--nui-paginator-page-jump-input-width);
    padding: var(--spacing-xs) var(--spacing-sm);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    color: var(--nui-text-primary);
    background-color: var(--nui-bg-primary);
    border: var(--nui-paginator-input-border-width) solid var(--nui-border-primary);
    border-radius: var(--border-radius-md);
    text-align: center;
    transition: all var(--nui-paginator-transition-duration) var(--nui-paginator-transition-timing);

    &--disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    // Remove spinner arrows
    &::-webkit-inner-spin-button,
    &::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    appearance: textfield;
    -moz-appearance: textfield;
  }

  &-button {
    font-weight: var(--font-weight-semibold);
    border-radius: var(--border-radius-md);
    cursor: pointer;
    transition: all var(--nui-paginator-transition-duration) var(--nui-paginator-transition-timing);
    white-space: nowrap;
  }
}

// =======================
// PAGINATOR BASE
// =======================
.nui-paginator {
  display: inline-flex;
  align-items: center;
  gap: var(--nui-paginator-gap);
  user-select: none;

  // Estado deshabilitado del contenedor
  &--disabled {
    opacity: var(--nui-paginator-disabled-opacity);
    pointer-events: none;
  }
}

// =======================
// BOTONES DE PAGINACIÓN
// =======================
.nui-paginator__button,
.nui-paginator__page-jump-button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border: var(--nui-paginator-button-border-width) solid transparent;
  border-radius: var(--border-radius-md);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all var(--nui-paginator-transition-duration) var(--nui-paginator-transition-timing);
  position: relative;
  z-index: var(--nui-paginator-z-index-base);

  // Prevenir selección de texto
  user-select: none;
  -webkit-user-select: none;

  // Estados interactivos
  &:hover:not(&--disabled) {
    z-index: var(--nui-paginator-z-index-hover);
    transform: scale(var(--nui-paginator-animation-scale-to));
  }

  &:active:not(&--disabled) {
    z-index: var(--nui-paginator-z-index-active);
    transform: scale(var(--nui-paginator-animation-scale-from));
    outline: none;
  }

  &:focus-visible {
    outline: var(--nui-paginator-focus-outline-width) solid currentColor;
    outline-offset: var(--nui-paginator-focus-outline-offset);
  }

  // Estado deshabilitado
  &--disabled {
    cursor: not-allowed;
    opacity: var(--nui-paginator-disabled-opacity);
  }

  // Iconos dentro de los botones
  i {
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
  }
}

// =======================
// ELLIPSIS (...)
// =======================
.nui-paginator__ellipsis {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0 0.25rem;
  color: var(--nui-text-secondary);
  font-weight: var(--font-weight-medium);
  user-select: none;
}

// =======================
// TAMAÑOS
// =======================

@each $size-key in (xs, s, sm, md, lg, xl) {
  .nui-paginator-container--#{$size-key} {
    @include mixins.paginator-size(#{$size-key});
  }
}

// =======================
// COLORES Y VARIANTES
// =======================
@each $color in (primary, secondary, success, info, warning, danger, accent) {
  .nui-paginator-container {
    @include mixins.paginator-colors('solid', $color);
    @include mixins.paginator-colors('outline', $color);
    @include mixins.paginator-colors('ghost', $color);
  }
}

// =======================
// ACCESSIBILITY & LOADING
// =======================
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

.nui-paginator__loading {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm) var(--spacing-md);
  background-color: var(--nui-bg-secondary);
  border-radius: var(--border-radius-md);
  border: 1px solid var(--nui-border-primary);

  &-text {
    font-size: var(--font-size-sm);
    color: var(--nui-text-secondary);
    font-weight: var(--font-weight-medium);
  }
}

// =======================
// MODO INFINITO
// =======================
.nui-paginator__infinite {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-md);
  width: 100%;

  &-counter {
    display: flex;
    align-items: center;
    justify-content: center;

    &-text {
      font-size: var(--font-size-sm);
      color: var(--nui-text-secondary);
      font-weight: var(--font-weight-medium);
      text-align: center;
    }
  }

  &-end {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-md);

    &-text {
      font-size: var(--font-size-sm);
      color: var(--nui-text-disabled);
      font-style: italic;
    }
  }
}

.nui-paginator__load-more-button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs);
  border: 1px solid transparent;
  border-radius: var(--border-radius-md);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all var(--transition-duration-fast) var(--transition-easing);

  &:disabled {
    cursor: not-allowed;
    opacity: var(--opacity-disabled);
  }

  &--loading {
    .nui-paginator__loading-icon {
      animation: spin 1s linear infinite;
    }
  }
}

@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

// =======================
// MODO COMPACTO
// =======================
.nui-paginator-container--fractional,
.nui-paginator-container--compact {
  .nui-paginator__current-page,
  .nui-paginator__fractional-info {
    display: flex;
    align-items: center;
    margin: 0 var(--nui-paginator-compact-spacing);
  }
}

// =======================
// CUSTOM LAYOUT SYSTEM
// =======================
.nui-paginator-container--custom-layout {
  display: flex;

  // Cada área es una fila horizontal independiente
  .nui-paginator__area {
    display: flex;
    align-items: center;
    gap: 1rem; // Espaciado horizontal entre elementos

    // Distribución horizontal inteligente
    &--top,
    &--bottom {
      flex-direction: row; // SIEMPRE horizontal (los elementos van en fila)
      flex-wrap: wrap; // Permite wrap si es necesario

      // DISTRIBUCIÓN SEGÚN CANTIDAD DE ELEMENTOS Y ALINEACIÓN

      // Default: si está centrado
      &.nui-paginator__area--centered {
        justify-content: center;
      }

      // Si no es centrado explícito, usar lógica inteligente:
      &:not(.nui-paginator__area--centered) {
        // 1 elemento: Alineado a la izquierda
        &.nui-paginator__area--single {
          justify-content: flex-start;
        }

        // 2 elementos: Separados en extremos (sin hueco en medio)
        &.nui-paginator__area--double {
          justify-content: space-between;
        }

        // 3+ elementos: Distribuidos al inicio con gap consistente
        &.nui-paginator__area--triple {
          justify-content: flex-start;
          gap: 1rem;
        }
      }
    }

    // ÁREA LEFT: Alineada al inicio
    &--left {
      justify-content: flex-start;
      flex: 0 1 auto; // Puede encogerse pero no crecer más de su contenido
    }

    // ÁREA CENTER: Ocupa el espacio central
    &--center {
      justify-content: center;
      flex: 0 1 auto; // Flexible pero contenido
      min-width: 0; // Permite shrink si es necesario
      flex-wrap: wrap; // Permite wrap en botones de navegación

      // Si no hay left/right, center se expande para llenar
      &:only-child {
        flex: 1 1 auto;
      }
    }

    // ÁREA RIGHT: Alineada al final
    &--right {
      justify-content: flex-end;
      flex: 0 1 auto; // Puede encogerse pero no crecer más de su contenido
    }
  }

  // CONTENEDOR HORIZONTAL: Para áreas left/center/right
  .nui-paginator__horizontal-areas {
    container-type: inline-size;
    container-name: paginator-row;

    display: flex;
    align-items: center;
    width: 100%;
    gap: 1rem;
    flex-wrap: wrap; // Permite wrap en pantallas pequeñas

    // Por defecto: distribución horizontal con espacio entre áreas
    flex-direction: row;

    // CONTAINER QUERY: Cuando el ancho < 1024px, reorganizamos las áreas
    @container paginator-row (max-width: 800px) {
      // Forzar wrap de las áreas
      flex-wrap: wrap;
      gap: var(--spacing-md);

      // Cada área se adapta según su contenido
      .nui-paginator__area {
        &--left,
        &--center,
        &--right {
          // Si el área tiene elementos, ocupar todo el ancho y distribuir con space-between
          &:not(:empty) {
            flex: 1 1 100%; // Ocupar todo el ancho
            width: 100%;
            justify-content: space-between; // Distribuir elementos
            gap: var(--spacing-sm);

            // Si solo hay 1 elemento, alinearlo según su área original
            &.nui-paginator__area--single-item {
              justify-content: flex-start;
            }
          }
        }

        // Left sigue alineado al inicio cuando tiene 1 elemento
        &--left:not(:empty) {
          justify-content: flex-start;

          // Pero si tiene múltiples elementos, space-between
          &:has(> *:nth-child(2)) {
            justify-content: space-between;
          }
        }

        // Center debe centrarse si es único, sino space-between
        &--center:not(:empty) {
          justify-content: center;

          // Si tiene múltiples elementos, space-between
          &:has(> *:nth-child(2)) {
            justify-content: space-between;
          }
        }

        // Right alineado al final si 1 elemento, space-between si varios
        &--right:not(:empty) {
          justify-content: flex-end;

          &:has(> *:nth-child(2)) {
            justify-content: space-between;
          }
        }
      }
    }
  }
}

// OVERRIDE: Si el layout principal es column, NO afectar horizontal-areas
// (Ya está en column por --custom-layout, no necesitamos este override)
.nui-paginator-container--layout-column {
  // Las áreas top/center/bottom ya se apilan verticalmente por --custom-layout
  // Solo aseguramos que horizontal-areas mantenga su dirección horizontal
  .nui-paginator__horizontal-areas {
    flex-direction: row; // Mantener horizontal SIEMPRE
  }
}

// =======================
// RESPONSIVE MÓVIL
// =======================
@media (max-width: 768px) {
  .nui-paginator-container--custom-layout {
    // Container ya es column por defecto

    // Áreas horizontales se convierten en verticales en móvil
    .nui-paginator__horizontal-areas {
      flex-direction: column;
      align-items: stretch;
    }

    // Áreas individuales también verticales en móvil si hay muchos elementos
    .nui-paginator__area {
      width: 100%;
      justify-content: center;
      flex-wrap: wrap;
      gap: var(--spacing-xs);

      &--center {
        flex-wrap: wrap;
        justify-content: center;
      }

      &--bottom,
      &--top {
        margin: 0;
        justify-content: center;

        .nui-paginator__page-size,
        .nui-paginator__info {
          justify-content: center;
        }

        // Áreas con muchos elementos: apilar verticalmente
        &.nui-paginator__area--triple {
          flex-direction: column;
          align-items: stretch;
        }
      }
    }
  }

  .nui-paginator__page-jump {
    gap: var(--spacing-xs);
  }

  .nui-paginator-container--wrap {
    .nui-paginator {
      flex-wrap: wrap;
      gap: var(--spacing-xs);
    }
  }

  // Permitir que los elementos se envuelvan en móviles
  .nui-paginator {
    flex-wrap: wrap;
    justify-content: center;
  }

  // =======================
  // TOUCH TARGETS MÓVIL (44px mínimo)
  // =======================

  // Aumentar área táctil en botones para cumplir estándares iOS/Android
  .nui-paginator__button,
  .nui-paginator__page-jump-button {
    min-width: 44px; // Mínimo recomendado por Apple/Google
    min-height: 44px;
    padding: 0.75rem; // Más espacio interno
  }

  // Input de salto de página touch-friendly
  .nui-paginator__page-jump-input {
    min-height: 44px;
    font-size: 16px; // Evitar zoom automático en iOS
    padding: 0.75rem;
  }

  // Gap aumentado en móvil para mejor separación
  .nui-paginator {
    gap: var(--spacing-md); // 16px en lugar de 8px
  }

  .nui-paginator-container {
    gap: var(--spacing-md); // Consistente con el gap interno
  }

  // Área top: elementos apilados verticalmente en móvil muy estrecho
  @media (max-width: 480px) {
    .nui-paginator__area--top {
      flex-direction: column;
      width: 100%;

      .nui-paginator__info,
      .nui-paginator__page-size,
      .nui-paginator__page-jump {
        width: 100%;
        justify-content: center;
      }
    }
  }
}
