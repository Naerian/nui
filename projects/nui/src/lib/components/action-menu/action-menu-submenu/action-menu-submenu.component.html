<div
  class="nui-action-menu-submenu nui-action-menu-submenu--{{ size }} nui-action-menu-submenu--{{ color }}"
  cdkMenu
  role="menu"
  [attr.aria-orientation]="'vertical'"
>
  @for (item of items; track item.id) {
    <!-- Separador -->
    @if (item.separator) {
      @if (item.label) {
        <div class="nui-action-menu__separator nui-action-menu__separator--labeled" role="separator">
          <span class="nui-action-menu__separator__label">{{ item.label }}</span>
        </div>
      } @else {
        <div class="nui-action-menu__separator" role="separator"></div>
      }
    }
    
    <!-- Item normal -->
    @if (!item.children && !item.separator) {
      <button
        class="nui-action-menu-submenu__item nui-action-menu-submenu__item--action"
        [class.nui-action-menu-submenu__item--selected]="item.selected"
        cdkMenuItem
        [disabled]="item.disabled"
        (cdkMenuItemTriggered)="onItemClick(item)"
        [attr.aria-label]="item.title || item.label"
        [attr.aria-current]="item.selected ? 'true' : null"
        role="menuitem"
        type="button"
      >
        @if (item.icon) {
          <i [class]="item.icon" class="nui-action-menu__item__icon"></i>
        }
        @if (item.templateRef && !item.label) {
          <ng-container *ngTemplateOutlet="item.templateRef"></ng-container>
        } @else {
          <div class="nui-action-menu__item__text">
            <span class="nui-action-menu-submenu__item__label">{{ item.label }}</span>
            @if (item.subtitle) {
              <span class="nui-action-menu__item__subtitle">{{ item.subtitle }}</span>
            }
          </div>
        }
        @if (item.shortcut) {
          <span class="nui-action-menu-submenu__item__shortcut">{{
            item.shortcut
          }}</span>
        }
        @if (item.selected) {
          <i class="ri-check-line nui-action-menu__item__check"></i>
        }
      </button>
    }

    @if (item.children && !item.separator) {
      <button
        class="nui-action-menu-submenu__item nui-action-menu-submenu__item--submenu"
        [cdkMenuTriggerFor]="subMenuTemplate"
        [cdkMenuTriggerData]="{ item: item }"
        cdkMenuItem
        [disabled]="item.disabled"
        [attr.aria-label]="item.title || item.label"
        [attr.aria-haspopup]="'menu'"
        [attr.aria-expanded]="false"
        role="menuitem"
        type="button"
      >
        <div class="nui-action-menu-submenu__item__container">
          @if (item.icon) {
            <i [class]="item.icon" class="nui-action-menu__item__icon"></i>
          }
          @if (item.templateRef && !item.label) {
            <ng-container *ngTemplateOutlet="item.templateRef"></ng-container>
          } @else {
            <div class="nui-action-menu__item__text">
              <span class="nui-action-menu-submenu__item__label">{{ item.label }}</span>
              @if (item.subtitle) {
                <span class="nui-action-menu__item__subtitle">{{ item.subtitle }}</span>
              }
            </div>
          }
        </div>
        <span class="nui-action-menu-submenu__item__arrow">
          <i [class]="iconSubmenu"></i>
        </span>
      </button>
    }
  }
</div>

<ng-template #subMenuTemplate let-item="item">
  <nui-action-menu-submenu
    (onItemAction)="onItemAction.emit($event)"
    [iconSubmenu]="iconSubmenu"
    [size]="size"
    [color]="color"
    [items]="item.children"
  ></nui-action-menu-submenu>
</ng-template>
