@use "../mixins";
@use "../variables/toast/toast-variables.scss";

// ===== CONTENEDOR GLOBAL =====
.nui-toast-container {
  position: fixed;
  z-index: var(--nui-toast-z-index);
  pointer-events: none;
  display: flex;
  flex-direction: column;
  gap: var(--nui-toast-stack-gap);
  max-height: 100vh;

  // ===== POSICIONES =====

  // Top positions
  &--top-left {
    top: var(--nui-toast-offset-y, 1rem);
    left: var(--nui-toast-offset-x, 1rem);
    align-items: flex-start;
  }

  &--top-center {
    top: var(--nui-toast-offset-y, 1rem);
    left: 50%;
    transform: translateX(-50%);
    align-items: center;
  }

  &--top-right {
    top: var(--nui-toast-offset-y, 1rem);
    right: var(--nui-toast-offset-x, 1rem);
    align-items: flex-end;
  }

  &--top-full {
    top: 0;
    left: 0;
    right: 0;
    align-items: stretch;
    gap: 0;

    .nui-toast-container__wrapper {
      gap: 0;
    }
  }

  // Middle positions
  &--middle-left {
    top: 50%;
    left: var(--nui-toast-offset-x, 1rem);
    transform: translateY(-50%);
    align-items: flex-start;
  }

  &--middle-center {
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    align-items: center;
  }

  &--middle-right {
    top: 50%;
    right: var(--nui-toast-offset-x, 1rem);
    transform: translateY(-50%);
    align-items: flex-end;
  }

  // Bottom positions con stacking mejorado
  &--bottom-left {
    bottom: var(--nui-toast-offset-y, 1rem);
    left: var(--nui-toast-offset-x, 1rem);
    align-items: flex-start;
    flex-direction: column-reverse;

    .nui-toast-container__wrapper {
      flex-direction: column-reverse;
    }

    // Efecto visual de stacking mejorado
    .nui-toast:not(:first-child) {
      transform: scale(var(--nui-toast-stack-scale-1))
        translateY(var(--nui-toast-stack-translate-y-1));
      opacity: var(--nui-toast-stack-opacity-1);
      filter: blur(var(--nui-toast-stack-blur-1));
      transition: all var(--nui-toast-transition-duration)
        var(--nui-toast-transition-easing);

      &:hover {
        transform: scale(1) translateY(0);
        opacity: 1;
        filter: blur(0);
        z-index: 1;
      }
    }

    .nui-toast:not(:first-child):not(:nth-child(2)) {
      transform: scale(var(--nui-toast-stack-scale-2))
        translateY(var(--nui-toast-stack-translate-y-2));
      opacity: var(--nui-toast-stack-opacity-2);
      filter: blur(var(--nui-toast-stack-blur-2));
    }
  }

  &--bottom-center {
    bottom: var(--nui-toast-offset-y, 1rem);
    left: 50%;
    transform: translateX(-50%);
    align-items: center;
    flex-direction: column-reverse;

    .nui-toast-container__wrapper {
      flex-direction: column-reverse;
    }

    // Efecto visual de stacking mejorado
    .nui-toast:not(:first-child) {
      transform: scale(var(--nui-toast-stack-scale-1))
        translateY(var(--nui-toast-stack-translate-y-1));
      opacity: var(--nui-toast-stack-opacity-1);
      filter: blur(var(--nui-toast-stack-blur-1));
      transition: all var(--nui-toast-transition-duration)
        var(--nui-toast-transition-easing);

      &:hover {
        transform: scale(1) translateY(0);
        opacity: 1;
        filter: blur(0);
        z-index: 1;
      }
    }

    .nui-toast:not(:first-child):not(:nth-child(2)) {
      transform: scale(var(--nui-toast-stack-scale-2))
        translateY(var(--nui-toast-stack-translate-y-2));
      opacity: var(--nui-toast-stack-opacity-2);
      filter: blur(var(--nui-toast-stack-blur-2));
    }
  }

  &--bottom-right {
    bottom: var(--nui-toast-offset-y, 1rem);
    right: var(--nui-toast-offset-x, 1rem);
    align-items: flex-end;
    flex-direction: column-reverse;

    .nui-toast-container__wrapper {
      flex-direction: column-reverse;
    }

    // Efecto visual de stacking mejorado
    .nui-toast:not(:first-child) {
      transform: scale(var(--nui-toast-stack-scale-1))
        translateY(var(--nui-toast-stack-translate-y-1));
      opacity: var(--nui-toast-stack-opacity-1);
      filter: blur(var(--nui-toast-stack-blur-1));
      transition: all var(--nui-toast-transition-duration)
        var(--nui-toast-transition-easing);

      &:hover {
        transform: scale(1) translateY(0);
        opacity: 1;
        filter: blur(0);
        z-index: 1;
      }
    }

    .nui-toast:not(:first-child):not(:nth-child(2)) {
      transform: scale(var(--nui-toast-stack-scale-2))
        translateY(var(--nui-toast-stack-translate-y-2));
      opacity: var(--nui-toast-stack-opacity-2);
      filter: blur(var(--nui-toast-stack-blur-2));
    }
  }

  &--bottom-full {
    bottom: 0;
    left: 0;
    right: 0;
    align-items: stretch;
    flex-direction: column-reverse;
    gap: 0;

    .nui-toast-container__wrapper {
      flex-direction: column-reverse;
      gap: 0;
    }
  }

  &--top-full,
  &--bottom-full {
    .nui-toast {
      width: 100%;
      max-width: none;
      border-radius: 0;
    }

    .nui-toast__container,
    .nui-toast__progress-bar {
      border-radius: 0;
    }
  }
}

// Wrapper del contenedor
.nui-toast-container__wrapper {
  display: flex;
  flex-direction: column;
  gap: var(--nui-toast-stack-gap, 0.75rem);
  width: 100%;
  max-height: 100%;

  &::-webkit-scrollbar {
    display: none;
  }
}

// ===== TOAST INDIVIDUAL =====
.nui-toast {
  display: block;
  width: var(--nui-toast-width);
  max-width: var(--nui-toast-max-width);
  min-height: var(--nui-toast-min-height);
  border-radius: var(--nui-toast-radius);
  box-shadow: var(--nui-toast-shadow);

  opacity: var(--nui-toast-opacity);
  pointer-events: auto;
  position: relative;
  overflow: hidden;

  // Transiciones suaves
  transition: transform var(--nui-toast-transition-duration)
      var(--nui-toast-transition-easing),
    opacity var(--nui-toast-transition-duration)
      var(--nui-toast-transition-easing),
    box-shadow var(--nui-toast-transition-duration)
      var(--nui-toast-transition-easing),
    filter var(--nui-toast-transition-duration)
      var(--nui-toast-transition-easing);

  // Borde interno sutil con pseudo-elemento
  &::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: inherit;
    padding: 1px;
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.15) 0%,
      rgba(255, 255, 255, 0.08) 50%,
      rgba(255, 255, 255, 0.02) 100%
    );
    -webkit-mask: linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    pointer-events: none;
    opacity: 0.6;
    z-index: 1;
  }

  // Hover mejorado
  &:hover {
    opacity: var(--nui-toast-hover-opacity);
    transform: translateY(-2px) scale(1.01);
  }

  // Custom (sin color específico)
  &.nui-toast--custom {
    background-color: var(--nui-toast-bg);
    color: var(--nui-toast-color);
    border: var(--nui-toast-border-width) solid var(--nui-toast-border-color);
  }

  // Generar variantes de color
  @include mixins.generate-toast-colors();
}

// ===== ELEMENTOS DEL TOAST =====

.nui-toast__container {
  position: relative;
  display: flex;
  flex-direction: column;
  width: 100%;
  padding: var(--nui-toast-padding);
}

.nui-toast__body {
  display: flex;
  align-items: flex-start;
  gap: var(--nui-toast-gap);
  width: 100%;
}

.nui-toast__icon {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--nui-toast-icon-size);
  line-height: 1;
  width: var(--nui-toast-icon-bg-size);
  height: var(--nui-toast-icon-bg-size);
  border-radius: 0.5rem;
  transition: all 0.3s var(--nui-toast-transition-easing);

  i {
    display: block;
    transition: transform 0.3s var(--nui-toast-transition-easing);
  }

  // Animación sutil en hover del toast
  .nui-toast:hover & {
    i {
      transform: scale(1.08);
    }
  }
}

.nui-toast__content {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: var(--nui-toast-content-gap);
  min-width: 0;
}

.nui-toast__title {
  font-weight: var(--nui-toast-title-weight);
  font-size: var(--nui-toast-title-size);
  line-height: var(--nui-toast-title-line-height);
  margin: 0;
  letter-spacing: -0.015em;
  color: inherit;
}

.nui-toast__message {
  font-size: var(--nui-toast-message-size);
  font-weight: var(--nui-toast-message-weight);
  line-height: var(--nui-toast-message-line-height);
  word-wrap: break-word;
  margin: 0;
  opacity: 0.92;
  color: inherit;
}

.nui-toast__html,
.nui-toast__template {
  font-size: var(--nui-toast-message-size);
  line-height: var(--nui-toast-message-line-height);

  // Estilos para contenido HTML sanitizado
  p {
    margin: 0 0 0.5em 0;

    &:last-child {
      margin-bottom: 0;
    }
  }

  a {
    text-decoration: underline;

    &:hover {
      opacity: 0.8;
    }
  }
}

// ===== ACCIONES =====

.nui-toast__actions {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
  align-items: center;
}

// ===== BOTONES DE CONTROL =====

.nui-toast__controls {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  display: flex;
  gap: 0.25rem;
  z-index: 1;
}

.nui-toast__close-button,
.nui-toast__expand-button {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2rem;
  height: 2rem;
  padding: 0;
  margin: -0.25rem 0;
  border: none;
  background: transparent;
  cursor: pointer;
  border-radius: var(--nui-toast-button-radius);
  transition: all 0.2s var(--nui-toast-transition-easing);
  font-size: 1.125rem;
  line-height: 1;
  color: currentColor;
  opacity: var(--nui-toast-button-opacity);

  i {
    display: block;
    transition: transform 0.2s var(--nui-toast-transition-easing);
  }

  &:hover {
    opacity: 1;
    background: rgba(0, 0, 0, 0.06);

    i {
      transform: scale(1.15);
    }
  }

  &:active {
    transform: scale(0.95);
    background: rgba(0, 0, 0, 0.1);
  }

  &:focus-visible {
    outline: 2px solid currentColor;
    outline-offset: 2px;
    opacity: 1;
  }
}

// ===== BARRA DE PROGRESO =====

.nui-toast__progress-bar {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: var(--nui-toast-progress-height);
  border-radius: 0 0 var(--nui-toast-radius) var(--nui-toast-radius);
  opacity: var(--nui-toast-progress-opacity);
  will-change: width;

  // Gradiente sutil en la progress bar
  background: linear-gradient(
    90deg,
    currentColor 0%,
    currentColor 85%,
    transparent 100%
  );

  // Animación de brillo sutil
  overflow: hidden;

  &::after {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent 0%,
      rgba(255, 255, 255, 0.4) 50%,
      transparent 100%
    );
    animation: progressShine 2.5s ease-in-out infinite;
  }
}

@keyframes progressShine {
  0% {
    left: -100%;
  }
  100% {
    left: 200%;
  }
}

// ===== CONTENIDO EXPANDIDO =====

.nui-toast__expanded-content {
  margin-top: 0.625rem;
  padding-top: 0.625rem;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  opacity: 0.88;
  font-size: var(--nui-toast-message-size);
  line-height: var(--nui-toast-message-line-height);
  white-space: pre-wrap;
  word-wrap: break-word;
  color: inherit;
}

// ===== VARIANTES DE ICONO =====

.nui-toast--icon-top {
  .nui-toast__container {
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 0.75rem;
  }

  .nui-toast__icon {
    font-size: var(--nui-toast-icon-size-top);
    width: 3rem;
    height: 3rem;
    margin-bottom: 0.25rem;
  }

  .nui-toast__content {
    align-items: center;
    width: 100%;
  }

  .nui-toast__title,
  .nui-toast__message {
    text-align: center;
  }

  // Ajustar posición de botones de control
  .nui-toast__close-button,
  .nui-toast__expand-button {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
  }
}

// ===== ESTADO EXPANDIDO =====

.nui-toast--expanded {
  .nui-toast__expanded-content {
    animation: expandContent var(--nui-toast-animation-duration) ease-out;
  }
}

@keyframes expandContent {
  from {
    max-height: 0;
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    max-height: 500px;
    opacity: 0.88;
    transform: translateY(0);
  }
}

// ===== ANIMACIONES DE LOADING =====

.nui-toast__icon {
  i.ri-loader-4-line,
  i.ri-loader-5-line,
  i.ri-loader-2-line {
    animation: toastSpin 1s linear infinite;
  }
}

@keyframes toastSpin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

// ===== RESPONSIVE =====

@media (max-width: var(--nui-toast-mobile-breakpoint)) {
  .nui-toast {
    --nui-toast-width: var(--nui-toast-width-mobile);
    --nui-toast-padding: var(--nui-toast-padding-compact);
    --nui-toast-offset-x: 0.75rem;
    --nui-toast-offset-y: 0.75rem;
  }

  .nui-toast__title {
    font-size: 0.875rem;
  }

  .nui-toast__message {
    font-size: 0.8125rem;
  }

  .nui-toast__icon {
    width: 2rem;
    height: 2rem;
    font-size: 1.25rem;
  }

  .nui-toast__close-button,
  .nui-toast__expand-button {
    width: 1.75rem;
    height: 1.75rem;
    font-size: 1rem;
  }
}

@media (max-width: 640px) {
  .nui-toast-container {
    --nui-toast-offset-x: 0.75rem;
    --nui-toast-offset-y: 0.75rem;
    max-width: calc(100vw - 1.5rem);

    // En móviles, las posiciones center ocupan más ancho
    &--top-center,
    &--middle-center,
    &--bottom-center {
      left: var(--nui-toast-offset-x, 0.75rem);
      right: var(--nui-toast-offset-x, 0.75rem);
      transform: none;
      align-items: stretch;
    }

    &--middle-center {
      top: 50%;
      transform: translateY(-50%);
    }
  }
}

// ===== ACCESIBILIDAD =====

// Reducir movimiento si el usuario lo prefiere
@media (prefers-reduced-motion: reduce) {
  .nui-toast {
    transition: opacity 0.15s ease;
    animation: none;

    &:hover {
      transform: none;
    }
  }

  .nui-toast__progress-bar {
    transition: none;

    &::after {
      animation: none;
    }
  }

  .nui-toast__icon i.ri-loader-4-line,
  .nui-toast__icon i.ri-loader-5-line,
  .nui-toast__icon i.ri-loader-2-line {
    animation: none;
  }

  .nui-toast-container {
    .nui-toast:not(:first-child) {
      transition: none;
      filter: none !important;
    }
  }
}

// Alto contraste
@media (prefers-contrast: high) {
  .nui-toast {
    border-width: 2px;

    &::before {
      opacity: 1;
    }
  }

  .nui-toast__progress-bar {
    height: calc(var(--nui-toast-progress-height) * 1.5);
  }
}

// ===== UTILIDADES =====

// Clase helper para toasts sin sombra
.nui-toast--no-shadow {
  box-shadow: none !important;
}

// Clase helper para toasts compactos
.nui-toast--compact {
  --nui-toast-padding: var(--nui-toast-padding-compact);
  --nui-toast-gap: 0.5rem;
  --nui-toast-content-gap: 0.125rem;

  .nui-toast__icon {
    width: 1.875rem;
    height: 1.875rem;
    font-size: 1.25rem;
  }
}

// Clase helper para toasts anchos
.nui-toast--wide {
  --nui-toast-width: 32rem;
}

// ===== ANIMACIONES CSS =====

// Animaciones de entrada mejoradas
@keyframes toastSlideIn {
  0% {
    transform: translateX(110%) scale(0.95);
    opacity: 0;
  }
  60% {
    transform: translateX(-5%) scale(1.02);
    opacity: 0.9;
  }
  100% {
    transform: translateX(0) scale(1);
    opacity: 1;
  }
}

@keyframes toastFadeIn {
  0% {
    opacity: 0;
    transform: translateY(-10px) scale(0.98);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

@keyframes toastBounceIn {
  0% {
    transform: scale(0.5);
    opacity: 0;
  }
  50% {
    transform: scale(1.05);
    opacity: 0.9;
  }
  70% {
    transform: scale(0.98);
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

@keyframes toastZoomIn {
  0% {
    transform: scale(0.3);
    opacity: 0;
  }
  50% {
    transform: scale(1.05);
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

@keyframes toastFlipIn {
  0% {
    transform: perspective(400px) rotate3d(1, 0, 0, 90deg);
    opacity: 0;
  }
  40% {
    transform: perspective(400px) rotate3d(1, 0, 0, -10deg);
  }
  70% {
    transform: perspective(400px) rotate3d(1, 0, 0, 5deg);
  }
  100% {
    transform: perspective(400px) rotate3d(0, 0, 0, 0deg);
    opacity: 1;
  }
}

// Animaciones de salida
@keyframes toastSlideOut {
  0% {
    transform: translateX(0) scale(1);
    opacity: 1;
  }
  100% {
    transform: translateX(110%) scale(0.95);
    opacity: 0;
  }
}

@keyframes toastFadeOut {
  0% {
    opacity: 1;
    transform: scale(1);
  }
  100% {
    opacity: 0;
    transform: scale(0.95);
  }
}

@keyframes toastShrinkOut {
  0% {
    transform: scale(1);
    opacity: 1;
    max-height: 200px;
  }
  50% {
    transform: scale(0.95);
    opacity: 0.5;
  }
  100% {
    transform: scale(0.9);
    opacity: 0;
    max-height: 0;
    margin: 0;
    padding: 0;
  }
}

@keyframes toastZoomOut {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(0.9);
    opacity: 0.5;
  }
  100% {
    transform: scale(0.3);
    opacity: 0;
  }
}

// Aplicar animaciones según estado
.nui-toast {
  // Animaciones de entrada (cuando aparece)
  &--anim-in-slide {
    animation: toastSlideIn var(--nui-toast-animation-duration, 300ms)
      var(--nui-toast-transition-easing);
  }

  &--anim-in-fade {
    animation: toastFadeIn var(--nui-toast-animation-duration, 300ms)
      var(--nui-toast-transition-easing);
  }

  &--anim-in-bounce {
    animation: toastBounceIn var(--nui-toast-animation-duration, 300ms)
      cubic-bezier(0.68, -0.55, 0.265, 1.55);
  }

  &--anim-in-zoom {
    animation: toastZoomIn var(--nui-toast-animation-duration, 300ms)
      var(--nui-toast-transition-easing);
  }

  &--anim-in-flip {
    animation: toastFlipIn var(--nui-toast-animation-duration, 300ms)
      var(--nui-toast-transition-easing);
  }
}
