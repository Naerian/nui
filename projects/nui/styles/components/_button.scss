@use '../abstracts/mixins' as global;
@use '../abstracts/mixins-base' as base;
@use '../variables/button-vars' as vars;

@mixin button-theme($color, $variant: 'solid') {
  // Dynamic CSS variables based on color and variant
  --button-bg: var(--nui-btn-#{$color}-#{$variant}-bg);
  --button-text: var(--nui-btn-#{$color}-#{$variant}-text);
  --button-border: var(--nui-btn-#{$color}-#{$variant}-border, transparent);

  // Hover
  --button-hover-bg: var(
    --nui-btn-#{$color}-#{$variant}-hover-bg,
    var(--nui-btn-#{$color}-#{$variant}-hover)
  );
  --button-hover-text: var(
    --nui-btn-#{$color}-#{$variant}-hover-text,
    var(--nui-btn-#{$color}-#{$variant}-text)
  );
  --button-hover-border: var(--nui-btn-#{$color}-#{$variant}-hover-border, transparent);

  // Active
  --button-active-bg: var(
    --nui-btn-#{$color}-#{$variant}-active-bg,
    var(--nui-btn-#{$color}-active)
  );
  --button-active-border: var(--nui-btn-#{$color}-#{$variant}-active-border, transparent);

  // Focus
  --nui-focus-ring-color: var(--nui-btn-#{$color}-focus-ring);
}

@mixin nui-button-styles {
  .nui-btn {
    display: inline-flex;
    gap: var(--nui-button-gap);
    justify-content: center;
    align-items: center;
    cursor: pointer;
    font-weight: var(--nui-button-font-weight);
    font-family: var(--nui-font-family);
    text-decoration: none !important;
    border-width: var(--nui-button-border-width);
    border-style: solid;
    transition: var(--nui-button-transition);
    vertical-align: middle;
    isolation: isolate;

    $colors: primary, secondary, success, info, warning, danger, accent, neutral;
    $variants: solid, outline, ghost;

    @each $color in $colors {
      &--#{$color} {
        // By default, apply the solid variant styles for the color preset
        @include button-theme($color, 'solid');

        @each $variant in $variants {
          &.nui-btn--#{$variant} {
            @include button-theme($color, $variant);
          }
        }
      }
    }

    background-color: var(--button-bg);
    color: var(--button-text);
    border-color: var(--button-border);

    &:hover:not(:disabled) {
      background-color: var(--button-hover-bg);
      color: var(--button-hover-text);
      border-color: var(--button-hover-border);
    }

    &:active:not(:disabled) {
      background-color: var(--button-active-bg);
      border-color: var(--button-active-border);
    }

    @include global.focus-ring;

    &:disabled,
    &.nui-btn--disabled {
      @include global.disabled;
    }

    $sizes: xs, s, sm, md, lg, xl;
    @each $size in $sizes {
      &.nui-btn--#{$size} {
        @include base.nui-component-size($size);
        border-radius: var(--nui-button-radius-#{$size});

        i {
          font-size: var(--nui-font-size-#{$size});
        }
      }
    }

    background-color: var(--button-bg);
    color: var(--button-text);
    border-color: var(--button-border);

    &:hover:not(:disabled) {
      background-color: var(--button-hover-bg);
      color: var(--button-hover-text);
      border-color: var(--button-hover-border);
    }

    &:active:not(:disabled) {
      background-color: var(--button-active-bg);
      border-color: var(--button-active-border);
    }

    &--full {
      width: 100%;
    }
    &--fit {
      width: fit-content;
    }

    &--icon {
      padding: 0 !important;
      gap: 0;

      @each $size in $sizes {
        &.nui-btn--#{$size} {
          width: var(--nui-height-#{$size});
          min-width: var(--nui-height-#{$size});
        }
      }
    }

    &--loading {
      position: relative;
      pointer-events: none !important;
    }

    i,
    &__icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 1em;
      height: 1em;
      flex-shrink: 0;
      line-height: 1;
      vertical-align: middle;
    }

    &__spinner {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 1em;
      height: 1em;
      line-height: 0;
      font-size: 1em;
      pointer-events: none;
      position: relative;

      &--center {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      &::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: 0.125em solid currentColor;
        border-radius: 50%;
        border-right-color: transparent;
        animation: nui-spin var(--nui-button-spin-duration) linear infinite;
        box-sizing: border-box;
        transform-origin: center center;
        will-change: transform;
      }
    }

    &:has(.nui-btn__content--empty) {
      gap: 0;
    }

    &__content {
      display: inline-flex;
      align-items: center;
      line-height: 1.5;

      &--hidden {
        visibility: hidden;
        opacity: 0;
      }
    }
  }
}