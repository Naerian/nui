@use '../abstracts/mixins' as mixins;

@mixin nui-sidebar-panel-styles {
  // ============================================================================
  // BASIC STRUCTURE & LAYOUT
  // ============================================================================

  .nui-sidebar-panel-pane {
    pointer-events: auto;
    height: 100%; // Required to fill the CDK container
    display: flex; // Ensures the child wrapper fills the space
    max-width: 100vw; // Prevents horizontal overflow on mobile
  }

  .nui-sidebar-panel-wrapper {
    display: flex;
    flex-direction: column;
    height: 100%;
    width: 100%;
    background: var(--nui-sidebar-panel-bg);
  }

  // HEADER (Fixed at top)
  .nui-sidebar-panel-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--nui-sidebar-panel-header-padding);
    padding-top: calc(
      var(--nui-sidebar-panel-header-padding) + env(safe-area-inset-top)
    ); // Notch support on mobile (iOS)
    border-bottom: 1px solid var(--nui-sidebar-panel-border);
    background: var(--nui-sidebar-panel-bg);
    flex-shrink: 0; // Crucial: Never shrink

    .nui-sidebar-panel-title {
      margin: 0;
      font-size: var(--nui-sidebar-panel-title-size);
      font-weight: var(--nui-sidebar-panel-title-weight);
      color: var(--nui-sidebar-panel-text);
    }

    .nui-sidebar-panel-header-actions {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.5rem; // var(--nui-spacing-xs)
    }
  }

  // CONTENT (Scrolls if overflow)
  .nui-sidebar-panel-content {
    flex: 1; // CRUCIAL: Occupies all remaining space
    overflow-y: auto; // Vertical scroll
    overflow-x: hidden;
    padding: var(--nui-sidebar-panel-content-padding);
    background: var(--nui-sidebar-panel-bg);

    // Custom scrollbar (Tu c√≥digo original)
    &::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    &::-webkit-scrollbar-track {
      background: var(--nui-sidebar-panel-scroll-bg);
    }

    &::-webkit-scrollbar-thumb {
      background: var(--nui-sidebar-panel-scroll-thumb-bg);
      border-radius: 4px;

      &:hover {
        background: var(--nui-sidebar-panel-scroll-thumb-hover-bg);
      }
    }

    scrollbar-width: thin;
    scrollbar-color: var(--nui-sidebar-panel-scroll-thumb-bg) transparent;
  }

  // FOOTER (Fixed at bottom)
  .nui-sidebar-panel-footer {
    padding: var(--nui-sidebar-panel-header-padding); // Using same padding as header
    padding: var(--nui-sidebar-panel-header-padding);
    padding-bottom: calc(
      var(--nui-sidebar-panel-header-padding) + env(safe-area-inset-bottom)
    ); // Notch support on mobile (iOS)
    background: var(--nui-sidebar-panel-bg);
    flex-shrink: 0; // Crucial: Never shrink

    &-actions {
      display: flex;
      justify-content: flex-end;
      flex-wrap: wrap;
      gap: var(--nui-spacing-sm);
    }
  }

  // ============================================================================
  // CDK OVERLAY & POSITIONING
  // ============================================================================

  .nui-sidebar-panel-overlay,
  .nui-sidebar-panel-backdrop {
    @include mixins.overlay-backdrop();
  }

  .cdk-overlay-pane.sidebar-panel-pane {
    z-index: var(--nui-sidebar-panel-z-index) !important;
  }

  // Panel Host Container (The container that moves the CDK)
  .sidebar-panel-container {
    position: fixed; // The CDK manages it, but this ensures
    overflow: hidden;
    z-index: var(--nui-sidebar-panel-z-index) !important;
    height: 100vh; // Always full height
    background-color: var(--nui-sidebar-panel-bg);
    box-shadow: var(--nui-sidebar-panel-shadow);
    color: var(--nui-sidebar-panel-text);
    display: flex;
    flex-direction: column;
    outline: none; // Visual accessibility

    // ===== POSITIONS =====
    // These classes should be added to the panelClass in your service

    &.sidebar-panel-position-right {
      top: 0;
      right: 0;
      left: auto;
      bottom: 0;
      border-left: 1px solid var(--nui-sidebar-panel-border);
    }

    &.sidebar-panel-position-left {
      top: 0;
      left: 0;
      right: auto;
      bottom: 0;
      border-right: 1px solid var(--nui-sidebar-panel-border);
    }

    &.sidebar-panel-position-top {
      top: 0;
      left: 0;
      right: 0;
      bottom: auto;
      width: 100%;
      height: auto;
      max-height: 50vh; // Top height limit
      border-bottom: 1px solid var(--nui-sidebar-panel-border);
    }

    &.sidebar-panel-position-bottom {
      bottom: 0;
      left: 0;
      right: 0;
      top: auto;
      width: 100%;
      height: auto;
      max-height: 85vh; // Bottom sheet height limit
      border-top: 1px solid var(--nui-sidebar-panel-border);
    }

    // ===== SIZES =====
    $sizes: xs, sm, md, lg, xl, full;
    @each $size in $sizes {
      &--size-#{$size} {
        width: var(--nui-sidebar-panel-size-#{$size}-width);
      }
    }

    &--size-full {
      border: none;
    }

    // Mobile: Always full
    @media (max-width: 768px) {
      width: 100vw !important;
      border: none !important;
      border-radius: 0 !important;
    }
  }
}
